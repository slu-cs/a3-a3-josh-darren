<html>

  <head>
      <meta charset="utf-8">
      <title>Making Poll</title>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  </head>

  <body>

<!-- Main Screen for a poll-->
    <div id="inital">
      <form class="m-3 border p-3" id="initial">
        <div class ="form-group">
          <p> Enter the Question</p>
          <input type="text" name="Name" id="question">
        </div>
        <div class ="form-group">
          <p>Enter The Number of Options Numerically</p>
          <input type="text" name="count" id="count">
        </div>
        <button type="submit" class="btn btn-primary">Create New Poll</button>
      </form>
    </div>

<!-- Enter the asnwers Screen-->
    <div id="answers"> </div>

<!-- Poll Check_box -->
    <div id="poll_check"> </div>

<!-- Poll radio buttons -->
    <div id="poll_radio"> </div>

<!-- table of results-->
    <div id="table" </div>


    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <script>

      // Needed later for the lables and
      let counter = 0;

      // Build up a set of inputs for answers
      $('#initial').on('submit', function(event) {
        event.preventDefault();

        const form = $(this);
        const cnt = form.find('#count');
        const qu = form.find('#question');
        const question =

        //Set up The Question
        $(`<h4 class="ml-2 mt-2"> Possible resposones for </h4>
           <h4 id="quest" class="ml-4 mb-2 mt-2 "> ${qu.val()} </h4>`);

        // Make the form
        const list = $('<form class="m-2 border p-3">');
        for (q = 0; q < cnt.val(); q++) {
          const li = $(`<div class = "form-group"> <input type="text" name="answer"></div>`)
          list.append(li);}


        list.append(`<button id="single"  class="btn btn-primary m-1">Submit Answer Key (Single Answer per poll)</button>`);
        list.append(`<button id='multi' class="btn btn-secondary m-1">Submit Answer Key (Mutliple Answers per poll)</button>`);

        // Append to the the answers div
        $('#answers').append(question);
        $('#answers').append(list);

        // Delte the current screen
        $(this).closest('div').remove();
      });

      // Set up the poll for single choice radio-button
      $('#answers').on('click','#single', function(event) {
        event.preventDefault();

        // all the varibales
        const form = $((this).closest('form'));
        const div = $((this).closest('div'));
        const inputs = form.find('input');
        const question = div.find('#quest');
        const list = $(`<form id="poll" class="m-3 border p-3"> <fieldset class="form-group"> </fieldset></form>`);

        // Need to Bootstrap
        // Set up our tally table
        const table = $(`<table style="width:100%" id="my_table"></table>`);
        table.append(`<tr> <th>Answer</th> <th>Count</th> </tr>`);

        // read through the Inputs and set up the poll and table
        for (let input of inputs){
          input = $(input);

          const li =
          $(`<div class="form-check">
            <input type="radio" id="${counter}" name="radio" value="${input.val()}" class="form-check-input">
            <label for="${counter}" class="form-check-label">${input.val()}</label>
            </div>`)

            // Need to Bootstrap
            const row = (`<tr> <th>${input.val()}</th> <th>0</th> </tr>`);

            table.append(row);
            list.append(li);
            counter += 1;}

        list.append(`<button type="submit" class="btn btn-primary m-3 p-2"> New Poll </button>`);
        list.append(`<button type="reset" id="tally" class="btn btn-primary m-3 p-2"> Tally all results </button>`);

        // Add info to the correct values
        $('#poll_radio').append(question);
        $('#poll_radio').append(list);
        $('#table').append(table);

        $(this).closest('div').remove();

      });

      // set up poll for multi choice check-boxes
      // Same as radio buttons only difference is that
      $('#answers').on('click','#multi', function(event) {
        event.preventDefault();


        const form = $((this).closest('form'));
        const div = $((this).closest('div'));
        const inputs = form.find('input');
        const question = div.find('#quest');
        const list = $(`<form id="poll" class="m-3 border p-3"> <fieldset class="form-group"> </fieldset></form>`);

        //Need to Boostrap
        const table = $(`<table style="width:100%" id="my_table"></table>`);
        table.append(`<tr> <th>Answer</th> <th class="value">Count</th> </tr>`);

        for (let input of inputs){
          input = $(input);

          const li =
          $(`<div class="form-check">
            <input type="checkbox" id="${counter}" name="check" value="${input.val()}" class="form-check-input">
            <label for="${counter}" class="form-check-label">${input.val()}</label>
           </div>`)

          const row = (`<tr> <th>${input.val()}</th> <th>0</th> </tr>`);

          table.append(row);
          list.append(li);
          counter += 1;}

        list.append(`<button type="submit" class="btn btn-primary m-3 p-2"> New Poll </button>`);
        list.append(`<button type="reset" id="tally" class="btn btn-primary m-3 p-2"> Tally all results </button>`);
        $('#poll_check').append(question);
        $('#poll_check').append(list);
        $('#table').append(table);

        $(this).closest('div').remove();
      });

      // Make a table of all the results
      $('#poll_check').on('click','#tally',function(event) {
        event.preventDefault();
        const form = $((this).closest('form'));
        const inputs = form.find('input');
        var answers = []

        for (let input of inputs){
          if ($(input).is(":checked")){
                  answers.push($(input).val())
                }

          $(input).prop('checked', false); }

          var table = $('#my_table');
          for (let val of answers){
            table.find('tr').each(function (i, el) {
              var $ths = $(this).find('th'),
                answer = $ths.eq(0).text(),
                value = $ths.eq(1).text()

                if (String(val) === String(answer)){
                  $(`#my_table tr:contains(${val}) th`).eq(1).html(Number(value) + 1);}
              });
            }
      });

      $('#poll_radio').on('click','#tally',function(event) {
        console.log(counter)
      });

    </script>
  </body>
</html>
